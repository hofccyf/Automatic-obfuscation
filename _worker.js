function a0b(a,b){a=a-0x176;const c=a0a();let d=c[a];return d;}const a0G=a0b;(function(a,b){const F=a0b,c=a();while(!![]){try{const d=-parseInt(F(0x1d2))/0x1*(-parseInt(F(0x1b3))/0x2)+parseInt(F(0x1e2))/0x3*(-parseInt(F(0x19e))/0x4)+parseInt(F(0x1b2))/0x5*(-parseInt(F(0x1d8))/0x6)+-parseInt(F(0x1b6))/0x7+parseInt(F(0x1ce))/0x8+-parseInt(F(0x1e6))/0x9+-parseInt(F(0x17f))/0xa*(-parseInt(F(0x17d))/0xb);if(d===b)break;else c['push'](c['shift']());}catch(e){c['push'](c['shift']());}}}(a0a,0x4ce3c));const a0c=a0G(0x181);let a0d=a0G(0x1ad),a0e=null,a0f=![],a0g='',a0h={};export default{async 'fetch'(a){const H=a0G;try{const b=new URL(a['url']),c=a['headers']['get'](H(0x1a1));if(c!==H(0x1bb))return new Response('Hello\x20World!',{'status':0xc8});else{a0d=a0d?a0d:a['cf'][H(0x1ae)]+H(0x19f),await a0t(a);const [d,e]=await a0s(a0d);return await a0i(a,{'parsedSocks5Address':a0h,'enableSocks':a0e,'enableGlobalSocks':a0f,'ProxyIP':d,'ProxyPort':e});}}catch(f){return new Response(f&&f[H(0x1c3)]?f[H(0x1c3)]:String(f),{'status':0x1f4});}}};async function a0i(a,b){const I=a0G,{parsedSocks5Address:c,enableSocks:d,enableGlobalSocks:e,ProxyIP:f,ProxyPort:g}=b,h=new WebSocketPair(),[i,j]=Object[I(0x179)](h);j[I(0x1c5)]();let k=setInterval(()=>{const J=I;if(j[J(0x17a)]===a0r)try{j[J(0x1a7)](new Uint8Array(0x0));}catch(r){}},0x7530);function l(){k&&(clearInterval(k),k=null);}j['addEventListener'](I(0x1db),l),j[I(0x1a4)](I(0x1a9),l);const m=a[I(0x180)][I(0x1d9)](I(0x1b9))||'',n=a0j(j,m);let o=null,p=null,q=![];return n[I(0x18d)](new WritableStream({async 'write'(r){const K=I;if(q&&p)return p(r);if(o){try{const y=o[K(0x1d1)][K(0x187)]();await y[K(0x1b5)](r),y[K(0x1d3)]();}catch(z){a0m(o);throw z;}return;}const s=a0k(r);if(s['hasError'])throw new Error(s[K(0x1cc)]);if(s[K(0x1e8)][K(0x1de)](atob(K(0x1d0))))throw new Error(K(0x1dc));const t=new Uint8Array([s[K(0x1d5)][0x0],0x0]),u=r[K(0x17c)](s[K(0x1e4)]);if(s[K(0x1b1)]){if(s[K(0x1d6)]===0x35){q=!![];const {write:A}=await a0q(j,t);p=A,p(u);return;}else throw new Error('UDP代理仅支持DNS(端口53)');}async function v(B,C){const L=K,D=await connect({'hostname':B,'port':C},{'allowHalfOpen':!![]});o=D;const E=D[L(0x1d1)][L(0x187)]();return await E[L(0x1b5)](u),E[L(0x1d3)](),D;}async function w(B,C){const M=K,D=d===M(0x1e7)?await a0o(s[M(0x1d4)],B,C,c):await a0p(s[M(0x1d4)],B,C,c);o=D;const E=D[M(0x1d1)][M(0x187)]();return await E['write'](u),E['releaseLock'](),D;}async function x(){const N=K;try{let B;if(d==='socks5')B=await a0o(s[N(0x1d4)],s[N(0x1e8)],s[N(0x1d6)],c);else d===N(0x17e)?B=await a0p(s['addressType'],s['addressRemote'],s['portRemote'],c):B=await connect({'hostname':f,'port':g},{'allowHalfOpen':!![]});o=B;const C=B[N(0x1d1)][N(0x187)]();await C['write'](u),C['releaseLock'](),B[N(0x1df)][N(0x199)](()=>{})[N(0x182)](()=>{const O=N;j['readyState']===a0r&&j[O(0x1db)](0x3e8,'连接已关闭');}),a0l(B,j,t,null);}catch(D){a0m(o),j[N(0x1db)](0x3f3,N(0x186)+(D&&D[N(0x1cc)]?D[N(0x1cc)]:D));}}try{if(e){const B=await w(s[K(0x1e8)],s[K(0x1d6)]);a0l(B,j,t,x);}else{const C=await v(s[K(0x1e8)],s[K(0x1d6)]);a0l(C,j,t,x);}}catch(D){a0m(o),j['close'](0x3f3,'连接失败:\x20'+(D&&D['message']?D[K(0x1cc)]:D));}},'close'(){o&&a0m(o);}}))[I(0x199)](r=>{const P=I;a0m(o),j[P(0x1db)](0x3f3,P(0x17b)+(r&&r['message']?r[P(0x1cc)]:r));}),new Response(null,{'status':0x65,'webSocket':i});}function a0j(a,b){return new ReadableStream({'start'(c){const Q=a0b;a['addEventListener'](Q(0x1cc),d=>{const R=Q;c[R(0x1ba)](d[R(0x1eb)]);}),a[Q(0x1a4)]('close',()=>{const S=Q;c[S(0x1db)]();}),a[Q(0x1a4)](Q(0x1a9),d=>{c['error'](d);});if(b)try{const d=atob(b[Q(0x1c0)](/-/g,'+')[Q(0x1c0)](/_/g,'/')),f=Uint8Array[Q(0x19c)](d,g=>g[Q(0x1ea)](0x0));c[Q(0x1ba)](f['buffer']);}catch(g){}}});}function a0a(){const a8=['pipeTo','\x20expected:\x205','push','Proxy-Connection:\x20Keep-Alive\x0d\x0a','不支持的命令，仅支持TCP(01)和UDP(02)','pow','getReader','match','处理HTTP代理响应失败:\x20','toLowerCase','split','no\x20acceptable\x20methods','catch','\x20ms\x20后重试','arrayBuffer','from','warn','36184dvvBpw','.proxyIP.cmliuSSSS.NET','%3D','Upgrade','不支持的地址类型','fail\x20to\x20open\x20socks\x20connection','addEventListener','fail\x20to\x20auth\x20socks\x20server','read','send','getUint16','error','解析SOCKS5地址失败:','test','HTTP代理连接失败:\x20未收到成功响应','usip.88888888.xx.kg','colo','globalproxy','decode','isUDP','5cDxWTr','8zRGuPu','please\x20provide\x20username/password','write','3465035VnFvTu','substring','url','sec-websocket-protocol','enqueue','websocket','getUint8',')，将在\x20','startsWith','application/dns-message','replace','padStart','CONNECT\x20','stack','byteLength','accept','proxyip.','发送HTTP\x20CONNECT请求失败:','proxyip','join','lastIndexOf','has','message','floor','2443432jFJrVb','encode','c3BlZWQuY2xvdWRmbGFyZS5jb20=','writable','8243DwBdOt','releaseLock','addressType','vlessVersion','portRemote','invalid\x20addressType\x20is\x20','3232542QEoceA','get','HTTP/1.1\x20200','close','Access','数据传输错误','includes','closed','readable','length','6OlvdPk','Host:\x20','rawDataIndex','map','1226718LlFbeP','socks5','addressRemote','socks\x20server\x20version\x20error:\x20','charCodeAt','data','HTTP代理连接中断','.tp','replaceAll','values','readyState','内部错误:\x20','slice','17105bDlhYb','http','7490xizplo','headers','58889888-8888-8888-8888-588898885888','finally','toString','set','value','代理连接失败:\x20','getWriter','Connection:\x20Keep-Alive\x0d\x0a','Proxy-Authorization:\x20Basic\x20','发送HTTP\x20CONNECT请求失败:\x20','random','无效的用户'];a0a=function(){return a8;};return a0a();}function a0k(a){const T=a0G;if(a[T(0x1c4)]<0x18)return{'hasError':!![],'message':'无效的头部长度'};const b=new DataView(a),c=new Uint8Array(a[T(0x17c)](0x0,0x1)),d=a0n(new Uint8Array(a[T(0x17c)](0x1,0x11)));if(a0c&&d!==a0c)return{'hasError':!![],'message':T(0x18c)};const e=b[T(0x1bc)](0x11),f=b[T(0x1bc)](0x12+e);let g=![];if(f===0x1){}else{if(f===0x2)g=!![];else return{'hasError':!![],'message':T(0x191)};}let h=0x13+e;const j=b[T(0x1a8)](h);h+=0x2;const k=b[T(0x1bc)](h++);let l='';switch(k){case 0x1:l=Array[T(0x19c)](new Uint8Array(a[T(0x17c)](h,h+0x4)))[T(0x1c9)]('.'),h+=0x4;break;case 0x2:const m=b['getUint8'](h++);l=new TextDecoder()[T(0x1b0)](a[T(0x17c)](h,h+m)),h+=m;break;case 0x3:const n=[];for(let o=0x0;o<0x8;o++){n[T(0x18f)](b[T(0x1a8)](h)[T(0x183)](0x10)[T(0x1c1)](0x4,'0')),h+=0x2;}l=n[T(0x1c9)](':')[T(0x1c0)](/(^|:)0+(\w)/g,'$1$2');break;default:return{'hasError':!![],'message':T(0x1a2)};}return{'hasError':![],'addressRemote':l,'portRemote':j,'rawDataIndex':h,'vlessVersion':c,'isUDP':g,'addressType':k};}async function a0l(a,b,c,d=null,e=0x0){const X=a0G,f=0x8,g=0x80*0x400,h=0x2*0x400*0x400,i=0xa,j=0xc8;let k=![],l=![],m=[],n=0x0;const o=t=>{const U=a0b;if(t[U(0x1e1)]===0x1)return t[0x0];const u=t['reduce']((x,y)=>x+y['byteLength'],0x0),v=new Uint8Array(u);let w=0x0;for(const x of t){v['set'](x,w),w+=x[U(0x1c4)];}return v;},p=t=>{const V=a0b;let u=0x0;while(u<t[V(0x1c4)]){const v=Math['min'](u+g,t[V(0x1c4)]);b['send'](t[V(0x17c)](u,v)),u=v;}},q=()=>{const W=a0b;if(b['readyState']!==a0r||m[W(0x1e1)]===0x0)return;const t=o(m);m=[],n=0x0,p(t);},r=setInterval(q,i),s=a[X(0x1e0)][X(0x193)]();try{while(!![]){const {done:t,value:u}=await s[X(0x1a6)]();if(t)break;l=!![];if(b[X(0x17a)]!==a0r)break;if(!k){const v=new Uint8Array(c['byteLength']+u['byteLength']);v[X(0x184)](new Uint8Array(c),0x0),v[X(0x184)](u,c[X(0x1c4)]),m[X(0x18f)](v),n+=v[X(0x1c4)],k=!![];}else m[X(0x18f)](u),n+=u[X(0x1c4)];n>=h&&q();}s[X(0x1d3)](),q(),clearInterval(r);if(!l&&d&&e<f){const w=j*Math['pow'](0x2,e);console[X(0x19d)]('未收到数据，'+w+'\x20ms\x20后重试\x20('+(e+0x1)+'/'+f+')'),await new Promise(x=>setTimeout(x,w)),await d();return;}if(b[X(0x17a)]===a0r)b[X(0x1db)](0x3e8,'正常关闭');}catch(x){s[X(0x1d3)](),clearInterval(r),console[X(0x1a9)]('数据传输错误:',x),a0m(a);if(d&&e<f){const y=j*Math[X(0x192)](0x2,e);console['warn']('错误重试\x20('+(e+0x1)+'/'+f+X(0x1bd)+y+X(0x19a)),await new Promise(z=>setTimeout(z,y)),await d();return;}b[X(0x17a)]===a0r&&b[X(0x1db)](0x3f3,X(0x1dd));}}function a0m(a){if(a)try{a['close']();}catch(b){}}function a0n(a){const Y=a0G,b=Array[Y(0x19c)](a,c=>c['toString'](0x10)['padStart'](0x2,'0'))[Y(0x1c9)]('');return b['slice'](0x0,0x8)+'-'+b[Y(0x17c)](0x8,0xc)+'-'+b[Y(0x17c)](0xc,0x10)+'-'+b[Y(0x17c)](0x10,0x14)+'-'+b[Y(0x17c)](0x14);}async function a0o(a,b,c,d){const Z=a0G,{username:e,password:f,hostname:g,port:h}=d,i=connect({'hostname':g,'port':h}),j=new Uint8Array([0x5,0x2,0x0,0x2]),k=i[Z(0x1d1)]['getWriter']();await k[Z(0x1b5)](j);const l=i[Z(0x1e0)]['getReader'](),m=new TextEncoder();let n=(await l['read']())[Z(0x185)];if(n[0x0]!==0x5)throw new Error(Z(0x1e9)+n[0x0]+Z(0x18e));if(n[0x1]===0xff)throw new Error(Z(0x198));if(n[0x1]===0x2){if(!e||!f)throw new Error(Z(0x1b4));const q=new Uint8Array([0x1,e['length'],...m[Z(0x1cf)](e),f[Z(0x1e1)],...m[Z(0x1cf)](f)]);await k[Z(0x1b5)](q),n=(await l[Z(0x1a6)]())[Z(0x185)];if(n[0x0]!==0x1||n[0x1]!==0x0)throw new Error(Z(0x1a5));}let o;switch(a){case 0x1:o=new Uint8Array([0x1,...b[Z(0x197)]('.')[Z(0x1e5)](Number)]);break;case 0x2:o=new Uint8Array([0x3,b[Z(0x1e1)],...m[Z(0x1cf)](b)]);break;case 0x3:o=new Uint8Array([0x4,...b[Z(0x197)](':')['flatMap'](r=>[parseInt(r[Z(0x17c)](0x0,0x2),0x10),parseInt(r[Z(0x17c)](0x2),0x10)])]);break;default:throw new Error(Z(0x1d7)+a);}const p=new Uint8Array([0x5,0x1,0x0,...o,c>>0x8,c&0xff]);await k[Z(0x1b5)](p),n=(await l[Z(0x1a6)]())['value'];if(n[0x1]===0x0){}else throw new Error(Z(0x1a3));return k[Z(0x1d3)](),l[Z(0x1d3)](),i;}async function a0p(a,b,c,d){const a0=a0G,{username:e,password:f,hostname:g,port:h}=d,i=await connect({'hostname':g,'port':h});let j=a0(0x1c2)+b+':'+c+'\x20HTTP/1.1\x0d\x0a';j+=a0(0x1e3)+b+':'+c+'\x0d\x0a';if(e&&f){const o=e+':'+f,p=btoa(o);j+=a0(0x189)+p+'\x0d\x0a';}j+='User-Agent:\x20Mozilla/5.0\x20(Windows\x20NT\x2010.0;\x20Win64;\x20x64)\x20AppleWebKit/537.36\x0d\x0a',j+=a0(0x190),j+=a0(0x188),j+='\x0d\x0a';try{const q=i[a0(0x1d1)][a0(0x187)]();await q[a0(0x1b5)](new TextEncoder()[a0(0x1cf)](j)),q[a0(0x1d3)]();}catch(r){console[a0(0x1a9)](a0(0x1c7),r);throw new Error(a0(0x18a)+r['message']);}const k=i['readable']['getReader']();let l='',m=![],n=new Uint8Array(0x0);try{while(!![]){const {value:s,done:t}=await k['read']();if(t){console['error'](a0(0x176));throw new Error(a0(0x176));}const u=new Uint8Array(n[a0(0x1e1)]+s[a0(0x1e1)]);u[a0(0x184)](n),u[a0(0x184)](s,n[a0(0x1e1)]),n=u,l=new TextDecoder()['decode'](n);if(l[a0(0x1de)]('\x0d\x0a\x0d\x0a')){const v=l['indexOf']('\x0d\x0a\x0d\x0a')+0x4,w=l[a0(0x1b7)](0x0,v);if(w[a0(0x1be)](a0(0x1da))||w[a0(0x1be)]('HTTP/1.0\x20200')){m=!![];if(v<n[a0(0x1e1)]){const x=n[a0(0x17c)](v),y=new ReadableStream({'start'(B){B['enqueue'](x);}}),{readable:z,writable:A}=new TransformStream();y[a0(0x18d)](A)[a0(0x199)](B=>console[a0(0x1a9)]('处理剩余数据错误:',B)),i[a0(0x1e0)]=z;}}else{const B='HTTP代理连接失败:\x20'+w[a0(0x197)]('\x0d\x0a')[0x0];console['error'](B);throw new Error(B);}break;}}}catch(C){k['releaseLock']();throw new Error(a0(0x195)+C[a0(0x1cc)]);}k[a0(0x1d3)]();if(!m)throw new Error(a0(0x1ac));return i;}async function a0q(a,b){const a2=a0G;let c=![];const d=new TransformStream({'start'(f){},'transform'(f,g){const a1=a0b;for(let h=0x0;h<f[a1(0x1c4)];){const i=f[a1(0x17c)](h,h+0x2),j=new DataView(i)[a1(0x1a8)](0x0),k=new Uint8Array(f[a1(0x17c)](h+0x2,h+0x2+j));h=h+0x2+j,g[a1(0x1ba)](k);}},'flush'(f){}});d[a2(0x1e0)]['pipeTo'](new WritableStream({async 'write'(f){const a3=a2,g=await fetch('https://1.1.1.1/dns-query',{'method':'POST','headers':{'content-type':a3(0x1bf)},'body':f}),h=await g[a3(0x19b)](),i=h[a3(0x1c4)],j=new Uint8Array([i>>0x8&0xff,i&0xff]);a[a3(0x17a)]===a0r&&(c?a[a3(0x1a7)](await new Blob([j,h])['arrayBuffer']()):(a['send'](await new Blob([b,j,h])[a3(0x19b)]()),c=!![]));}}))[a2(0x199)](f=>{});const e=d[a2(0x1d1)][a2(0x187)]();return{'write'(f){const a4=a2;e[a4(0x1b5)](f);}};}const a0r=0x1;import{connect}from'cloudflare:sockets';async function a0s(a){const a5=a0G;a=a[a5(0x196)]();let b=a,c=0x1bb;if(a['includes'](a5(0x177))){const d=a['match'](/\.tp(\d+)/);if(d)c=parseInt(d[0x1],0xa);return[b,c];}if(a[a5(0x1de)](']:')){const e=a['split'](']:');b=e[0x0]+']',c=parseInt(e[0x1],0xa)||c;}else{if(a[a5(0x1de)](':')&&!a[a5(0x1be)]('[')){const f=a[a5(0x1ca)](':');b=a[a5(0x17c)](0x0,f),c=parseInt(a['slice'](f+0x1),0xa)||c;}}return[b,c];}async function a0t(a){const a6=a0G,b=new URL(a[a6(0x1b8)]),{pathname:c,searchParams:d}=b,e=c['toLowerCase']();a0g=d[a6(0x1d9)]('socks5')||d['get'](a6(0x17e))||null,a0f=d[a6(0x1cb)](a6(0x1af))||![];const f=e[a6(0x194)](/\/(proxyip[.=]|pyip=|ip=)(.+)/);if(d[a6(0x1cb)](a6(0x1c8))){const h=d[a6(0x1d9)](a6(0x1c8));a0d=h[a6(0x1de)](',')?h[a6(0x197)](',')[Math[a6(0x1cd)](Math[a6(0x18b)]()*h[a6(0x197)](',')['length'])]:h;return;}else{if(f){const i=f[0x1]===a6(0x1c6)?a6(0x1c6)+f[0x2]:f[0x2];a0d=i[a6(0x1de)](',')?i[a6(0x197)](',')[Math[a6(0x1cd)](Math[a6(0x18b)]()*i['split'](',')[a6(0x1e1)])]:i;return;}}let g;if(g=c[a6(0x194)](/\/(socks5?|http):\/?\/?(.+)/i)){a0e=g[0x1][a6(0x196)]()===a6(0x17e)?'http':a6(0x1e7),a0g=g[0x2][a6(0x197)]('#')[0x0],a0f=!![];if(a0g[a6(0x1de)]('@')){const j=a0g['lastIndexOf']('@');let k=a0g[a6(0x1b7)](0x0,j)[a6(0x178)](a6(0x1a0),'=');/^(?:[A-Z0-9+/]{4})*(?:[A-Z0-9+/]{2}==|[A-Z0-9+/]{3}=)?$/i[a6(0x1ab)](k)&&!k[a6(0x1de)](':')&&(k=atob(k)),a0g=k+'@'+a0g[a6(0x1b7)](j+0x1);}}else{if(g=c[a6(0x194)](/\/(g?s5|socks5|g?http)=(.+)/i)){const l=g[0x1][a6(0x196)]();a0g=g[0x2],a0e=l[a6(0x1de)](a6(0x17e))?'http':'socks5',a0f=l[a6(0x1be)]('g')||a0f;}}if(a0g)try{a0h=await a0u(a0g),a0e=d[a6(0x1d9)](a6(0x17e))?'http':a0e;}catch(m){console[a6(0x1a9)](a6(0x1aa),m[a6(0x1cc)]),a0e=null;}else a0e=null;}async function a0u(a){const a7=a0G,b=a[a7(0x1ca)]('@');let [c,d]=b===-0x1?[a,undefined]:[a[a7(0x1b7)](b+0x1),a['substring'](0x0,b)],e,f,g,h;if(d){const k=d[a7(0x197)](':');if(k[a7(0x1e1)]!==0x2)throw new Error('无效的\x20SOCKS\x20地址格式：认证部分必须是\x20\x22username:password\x22\x20的形式');[e,f]=k;}const i=c[a7(0x197)](':');if(i[a7(0x1e1)]>0x2&&c[a7(0x1de)](']:'))h=Number(c[a7(0x197)](']:')[0x1][a7(0x1c0)](/[^\d]/g,'')),g=c[a7(0x197)](']:')[0x0]+']';else i['length']===0x2?(h=Number(i['pop']()[a7(0x1c0)](/[^\d]/g,'')),g=i['join'](':')):(h=0x50,g=c);if(isNaN(h))throw new Error('无效的\x20SOCKS\x20地址格式：端口号必须是数字');const j=/^\[.*\]$/;if(g[a7(0x1de)](':')&&!j[a7(0x1ab)](g))throw new Error('无效的\x20SOCKS\x20地址格式：IPv6\x20地址必须用方括号括起来，如\x20[2001:db8::1]');return{'username':e,'password':f,'hostname':g,'port':h};}